<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mayank AI - Assistance</title>
    <style>
        /* Aapka original CSS - No Changes */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: radial-gradient(circle, #101820, #000000); 
            color: #00d2ff; font-family: 'Segoe UI', sans-serif; 
            height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
            background-image: linear-gradient(rgba(0, 210, 255, 0.05) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(0, 210, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        body::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: rgba(0, 210, 255, 0.1); animation: scan 4s linear infinite;
        }
        @keyframes scan { from { top: 0; } to { top: 100%; } }

        .arc-reactor {
            width: 180px; height: 180px; border-radius: 50%;
            border: 4px solid #00d2ff; position: relative;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 30px #00d2ff, inset 0 0 30px #00d2ff;
            cursor: pointer; transition: 0.5s; z-index: 10;
        }
        .arc-reactor.processing { border-color: #ff0055; box-shadow: 0 0 50px #ff0055; }
        
        .inner-circle {
            width: 120px; height: 120px; border-radius: 50%;
            border: 2px dashed #00d2ff; animation: rotate 5s linear infinite;
        }
        @keyframes rotate { 100% { transform: rotate(360deg); } }
        .active { animation: pulse 1s infinite alternate; background: rgba(0, 210, 255, 0.1); }
        @keyframes pulse { from { box-shadow: 0 0 20px #00d2ff; } to { box-shadow: 0 0 60px #00d2ff; } }
        
        #status { margin-top: 30px; font-size: 1.2rem; letter-spacing: 2px; text-transform: uppercase; text-shadow: 0 0 10px #00d2ff; }
        #response-box { 
            margin-top: 20px; width: 80%; max-width: 500px; 
            background: rgba(0, 210, 255, 0.05); padding: 15px; 
            border-radius: 10px; min-height: 50px; text-align: center;
            backdrop-filter: blur(5px); border: 1px solid rgba(0, 210, 255, 0.2);
        }
        
        .waves { display: none; gap: 5px; margin-top: 15px; height: 20px; align-items: center; }
        .bar { width: 3px; height: 100%; background: #00d2ff; animation: wave 0.5s infinite alternate; }
        @keyframes wave { from { height: 2px; } to { height: 20px; } }

        #permission-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div id="permission-overlay">
        <h2 style="margin-bottom: 20px; letter-spacing: 5px;">MAYANK AI ASSISTANCE</h2>
        <button onclick="activateSystem()" style="padding: 15px 30px; border: 2px solid #00d2ff; background: none; color: #00d2ff; border-radius: 50px; cursor: pointer; font-weight: bold; letter-spacing: 2px;">ACTIVATE CORE</button>
    </div>

    <audio id="bgm" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" type="audio/mpeg"></audio>
    <audio id="scan-sound"><source src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" type="audio/mpeg"></audio>

    <div id="reactor" class="arc-reactor">
        <div class="inner-circle"></div>
        <span style="position: absolute; font-size: 2rem; filter: drop-shadow(0 0 5px #00d2ff);">âš¡</span>
    </div>

    <div class="waves" id="waveform">
        <div class="bar"></div><div class="bar" style="animation-delay: 0.2s"></div><div class="bar" style="animation-delay: 0.1s"></div>
    </div>

    <h2 id="status">System Offline</h2>
    <div id="response-box">Say "Hey Mayank" to start...</div>

    <script>
        const statusText = document.getElementById('status');
        const responseBox = document.getElementById('response-box');
        const reactor = document.getElementById('reactor');
        const waveform = document.getElementById('waveform');
        const bgm = document.getElementById('bgm');
        const scanSound = document.getElementById('scan-sound');

        let isSpeaking = false;
        let recognition;

        function speak(text) {
            isSpeaking = true;
            waveform.style.display = 'flex';
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = 'hi-IN';
            utter.onend = () => {
                isSpeaking = false;
                waveform.style.display = 'none';
                reactor.classList.remove('processing');
                startMic();
            };
            window.speechSynthesis.speak(utter);
        }

        async function getGeminiResponse(query) {
            statusText.innerText = "Analyzing Neural Link...";
            reactor.classList.add('processing');
            try {
                // Calling Vercel Backend
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query })
                });
                const data = await res.json();
                
                statusText.innerText = "Data Stream Received";
                // Groq response formatting handled by backend
                return data.choices[0].message.content;
            } catch (e) { 
                return "Sir, uplink error detected. Please check Groq API settings."; 
            }
        }

        function activateSystem() {
            navigator.mediaDevices.getUserMedia({ audio: true }).then(() => {
                document.getElementById('permission-overlay').style.display = 'none';
                bgm.volume = 0.1;
                bgm.play();
                speak("Core systems online. Welcome back, Mayank.");
                initRecognition();
            }).catch(err => {
                alert("Mic permission denied!");
            });
        }

        function initRecognition() {
            const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRec) {
                alert("Browser not supported!");
                return;
            }
            recognition = new SpeechRec();
            recognition.continuous = true;
            recognition.lang = 'hi-IN';

            recognition.onstart = () => {
                statusText.innerText = "System Ready";
                reactor.classList.add('active');
            };

            recognition.onresult = async (event) => {
                if (isSpeaking) return;
                const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
                responseBox.innerText = "Heard: " + transcript;

                if (transcript.includes("hey mayank") || transcript.includes("mayank")) {
                    scanSound.play(); 
                    recognition.stop();
                    const aiRes = await getGeminiResponse(transcript);
                    responseBox.innerText = "Mayank AI: " + aiRes;
                    speak(aiRes);
                }
            };

            recognition.onend = () => { if(!isSpeaking) recognition.start(); };
            recognition.start();
        }

        function startMic() { if(recognition && !isSpeaking) try { recognition.start(); } catch(e) {} }
    </script>
</body>
</html>
